<html> <!-- -*- coding: utf-8 ; mode: xml -->
<head>
<script type="text/javascript" src="scripts/init.js"></script>
<script type="text/javascript">

chrome.tabs.onUpdated.addListener(function(id,info,tab) {
  var params = localStorage.getItem(tab.id);
  if(tab.pinned) {
    if (params == undefined) {
      params = {
        enabled:true,
        external_link_only:false
      };
      localStorage[tab.id] = params;
    }
    if (params.enabled == true) {
      chrome.tabs.executeScript(null, {file: "scripts/inject_targets.js"});
    }
  } else {
    if(params != undefined) {
      localStorage.removeItem(tab.id);
      chrome.tabs.executeScript(null, {file: "scripts/remove_targets.js"});
    }
  }
});

chrome.tabs.onCreated.addListener(function(tab) {
  if(tab.pinned) {
    var params = localStorage.getItem(tab.id);
    if(params != undefined && params.enabled == true) {
      chrome.tabs.executeScript(null, {file: "scripts/inject_targets.js"});
    }
  }
});

chrome.tabs.onRemoved.addListener(function(id,info) {
  var params = localStorage.getItem(id);
  if(params != undefined) {
    localStorage.removeItem(id);
    chrome.tabs.executeScript(null, {file: "scripts/remove_targets.js"});
  }
});

chrome.tabs.onDetached.addListener(function(id,info) {
  var params = localStorage.getItem(id);
  if(params != undefined) {
    localStorage.removeItem(id);
    chrome.tabs.executeScript(null, {file: "scripts/remove_targets.js"});
  }
});

</script>
</head>
</html>
